  [1m[35m (73.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "url_shortener_test"[0m
  [1m[35m (38.7ms)[0m  [1m[35mCREATE DATABASE "url_shortener_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "urls" CASCADE[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE TABLE "urls" ("id" bigserial primary key, "original_url" character varying NOT NULL, "short_code" character varying NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_urls_on_original_url" ON "urls" ("original_url")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_urls_on_short_code" ON "urls" ("short_code")[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20260104172836)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-01-04 17:33:12.269254', '2026-01-04 17:33:12.269262') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '9ba0e0f6193cb1ba1c73d8f48b5143db3dd10d1b', '2026-01-04 17:33:12.271939', '2026-01-04 17:33:12.271945') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (622654802, 'https://www.google.com/search?q=ruby+on+rails', 'abc123', '2026-01-04 17:33:12.389801', '2026-01-04 17:33:12.389801'), (595373034, 'https://github.com/rails/rails', 'def456', '2026-01-04 17:33:12.389801', '2026-01-04 17:33:12.389801')[0m
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (9.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UrlsControllerTest: test_encode_rejects_empty_URL
-------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "2MO4eL"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "2MO4eL"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 32ms (Views: 0.6ms | ActiveRecord: 1.7ms | Allocations: 13126)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
UrlsControllerTest: test_encode_rejects_invalid_URL
---------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "77jIS0"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "77jIS0"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1316)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_404_for_non-existent_short_code
-----------------------------------------------------------------------
Started GET "/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 325)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_original_URL_for_valid_short_code
-------------------------------------------------------------------------
  [1m[36mUrl Load (0.9ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (1.5ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 1.5ms | Allocations: 291)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_home_page_loads_successfully
-----------------------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#home as HTML
  Rendering layout layouts/application.html.erb
  Rendering urls/home.html.erb within layouts/application
  Rendered urls/home.html.erb within layouts/application (Duration: 0.9ms | Allocations: 530)
  Rendered layout layouts/application.html.erb (Duration: 242.9ms | Allocations: 66917)
Completed 200 OK in 259ms (Views: 251.4ms | ActiveRecord: 0.0ms | Allocations: 70705)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
UrlsControllerTest: test_redirect_forwards_to_original_URL
----------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/abc123" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Redirected to https://www.google.com/search?q=ruby+on+rails
Completed 301 Moved Permanently in 1ms (ActiveRecord: 0.3ms | Allocations: 269)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlsControllerTest: test_decode_accepts_full_short_URL
------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms | Allocations: 301)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_encode_creates_shortened_URL
-----------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/long/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "06701K"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "06701K"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/long/path"], ["short_code", "06701K"], ["created_at", "2026-01-04 17:33:12.903340"], ["updated_at", "2026-01-04 17:33:12.903340"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 1399)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_redirect_returns_404_for_non-existent_short_code
-------------------------------------------------------------------------
Started GET "/zzzzzz" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 3)
Completed 404 Not Found in 2ms (Views: 1.5ms | ActiveRecord: 0.2ms | Allocations: 500)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlsControllerTest: test_encoded_URLs_persist_and_can_be_decoded
----------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://persistence-test.com/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://persistence-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "3Letuq"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "3Letuq"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://persistence-test.com/path"], ["short_code", "3Letuq"], ["created_at", "2026-01-04 17:33:12.917681"], ["updated_at", "2026-01-04 17:33:12.917681"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 1248)
Started GET "/decode?short_code=3Letuq" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"3Letuq"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "3Letuq"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 242)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
UrlsControllerTest: test_encode_returns_same_short_URL_for_duplicate_original_URL
---------------------------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "tBksW2"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "tBksW2"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/duplicate-test"], ["short_code", "tBksW2"], ["created_at", "2026-01-04 17:33:12.929811"], ["updated_at", "2026-01-04 17:33:12.929811"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 1016)
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:33:12 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 232)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlTest: test_does_not_regenerate_short_code_on_update
------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "bcoY8u"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "bcoY8u"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "bcoY8u"], ["created_at", "2026-01-04 17:33:12.939721"], ["updated_at", "2026-01-04 17:33:12.939721"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Update (0.3ms)[0m  [1m[33mUPDATE "urls" SET "original_url" = $1, "updated_at" = $2 WHERE "urls"."id" = $3[0m  [["original_url", "https://example.org"], ["updated_at", "2026-01-04 17:33:12.945680"], ["id", 622654806]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlTest: test_encode_creates_new_URL_for_new_original_url
---------------------------------------------------------
  [1m[36mUrl Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://newsite.com/unique-path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "Glw0fv"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "Glw0fv"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://newsite.com/unique-path"], ["short_code", "Glw0fv"], ["created_at", "2026-01-04 17:33:12.952021"], ["updated_at", "2026-01-04 17:33:12.952021"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------
UrlTest: test_accepts_valid_HTTP_URL
------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "42xrpl"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "42xrpl"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_decode_finds_URL_by_short_code
--------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------
UrlTest: test_rejects_FTP_URL
-----------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "aUD7f7"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "aUD7f7"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------
UrlTest: test_short_code_uniqueness
-----------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_accepts_valid_HTTPS_URL
-------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "nszN90"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "nszN90"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlTest: test_decode_returns_nil_for_non-existent_short_code
------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlTest: test_validates_presence_of_original_url
------------------------------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WooeJf"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WooeJf"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_generates_short_code_on_create
--------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "tIqJV4"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "tIqJV4"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/new-page"], ["short_code", "tIqJV4"], ["created_at", "2026-01-04 17:33:12.974547"], ["updated_at", "2026-01-04 17:33:12.974547"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------
UrlTest: test_validates_URL_format
----------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "94CljW"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "94CljW"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UrlTest: test_encode_returns_existing_URL_for_same_original_url
---------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (622654802, 'https://www.google.com/search?q=ruby+on+rails', 'abc123', '2026-01-04 17:49:07.713771', '2026-01-04 17:49:07.713771'), (595373034, 'https://github.com/rails/rails', 'def456', '2026-01-04 17:49:07.713771', '2026-01-04 17:49:07.713771')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlTest: test_encode_creates_new_URL_for_new_original_url
---------------------------------------------------------
  [1m[36mUrl Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://newsite.com/unique-path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RmYIfU"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RmYIfU"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://newsite.com/unique-path"], ["short_code", "RmYIfU"], ["created_at", "2026-01-04 17:49:07.750849"], ["updated_at", "2026-01-04 17:49:07.750849"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------
UrlTest: test_short_code_uniqueness
-----------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------
UrlTest: test_accepts_valid_HTTP_URL
------------------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "TGfkSB"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "TGfkSB"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlTest: test_does_not_regenerate_short_code_on_update
------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "rMqp0P"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "rMqp0P"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "rMqp0P"], ["created_at", "2026-01-04 17:49:07.763393"], ["updated_at", "2026-01-04 17:49:07.763393"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Update (0.3ms)[0m  [1m[33mUPDATE "urls" SET "original_url" = $1, "updated_at" = $2 WHERE "urls"."id" = $3[0m  [["original_url", "https://example.org"], ["updated_at", "2026-01-04 17:49:07.768190"], ["id", 622654804]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UrlTest: test_encode_returns_existing_URL_for_same_original_url
---------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------
UrlTest: test_rejects_FTP_URL
-----------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7qhIWD"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7qhIWD"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_decode_finds_URL_by_short_code
--------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlTest: test_decode_returns_nil_for_non-existent_short_code
------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_generates_short_code_on_create
--------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "QEGPKr"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "QEGPKr"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/new-page"], ["short_code", "QEGPKr"], ["created_at", "2026-01-04 17:49:07.782679"], ["updated_at", "2026-01-04 17:49:07.782679"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------
UrlTest: test_validates_URL_format
----------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XnKBr5"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XnKBr5"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlTest: test_validates_presence_of_original_url
------------------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "S0qSGw"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "S0qSGw"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_accepts_valid_HTTPS_URL
-------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "sQZPAg"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "sQZPAg"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_404_for_non-existent_short_code
-----------------------------------------------------------------------
Started GET "/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 2ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 839)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_home_page_loads_successfully
-----------------------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#home as HTML
  Rendering layout layouts/application.html.erb
  Rendering urls/home.html.erb within layouts/application
  Rendered urls/home.html.erb within layouts/application (Duration: 0.8ms | Allocations: 529)
  Rendered layout layouts/application.html.erb (Duration: 49.1ms | Allocations: 30586)
Completed 200 OK in 56ms (Views: 52.8ms | ActiveRecord: 0.0ms | Allocations: 33185)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
UrlsControllerTest: test_encode_rejects_invalid_URL
---------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "KslJCp"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "KslJCp"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 1371)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UrlsControllerTest: test_encode_rejects_empty_URL
-------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "I2itaJ"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "I2itaJ"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1386)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
UrlsControllerTest: test_encode_returns_same_short_URL_for_duplicate_original_URL
---------------------------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "xyA5IX"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "xyA5IX"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/duplicate-test"], ["short_code", "xyA5IX"], ["created_at", "2026-01-04 17:49:07.964129"], ["updated_at", "2026-01-04 17:49:07.964129"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 1124)
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 235)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_original_URL_for_valid_short_code
-------------------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 246)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_encode_creates_shortened_URL
-----------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/long/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "mXmbfj"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "mXmbfj"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/long/path"], ["short_code", "mXmbfj"], ["created_at", "2026-01-04 17:49:07.979478"], ["updated_at", "2026-01-04 17:49:07.979478"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.4ms | Allocations: 1017)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlsControllerTest: test_encoded_URLs_persist_and_can_be_decoded
----------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://persistence-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://persistence-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "NwY9jG"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "NwY9jG"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://persistence-test.com/path"], ["short_code", "NwY9jG"], ["created_at", "2026-01-04 17:49:07.986578"], ["updated_at", "2026-01-04 17:49:07.986578"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1017)
Started GET "/decode?short_code=NwY9jG" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"NwY9jG"}
  [1m[36mUrl Load (0.4ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "NwY9jG"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 241)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
UrlsControllerTest: test_redirect_forwards_to_original_URL
----------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/abc123" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Redirected to https://www.google.com/search?q=ruby+on+rails
Completed 301 Moved Permanently in 1ms (ActiveRecord: 0.2ms | Allocations: 250)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_redirect_returns_404_for_non-existent_short_code
-------------------------------------------------------------------------
Started GET "/zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:07 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 3)
Completed 404 Not Found in 2ms (Views: 1.0ms | ActiveRecord: 0.2ms | Allocations: 435)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlsControllerTest: test_decode_accepts_full_short_URL
------------------------------------------------------
  [1m[36mUrl Load (0.5ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 328)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
UrlServiceTest: test_decode_handles_empty_input
-----------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_empty_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7l7lrz"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7l7lrz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
UrlServiceTest: test_encode_returns_existing_URL_for_duplicate
--------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlServiceTest: test_decode_returns_success_for_valid_short_code
----------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlServiceTest: test_decode_handles_nil_input
---------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
UrlServiceTest: test_decode_returns_failure_for_non-existent_code
-----------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_invalid_URL
-----------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-valid"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "SUSEe1"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "SUSEe1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_success_for_valid_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://service-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "souq6k"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "souq6k"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://service-test.com/path"], ["short_code", "souq6k"], ["created_at", "2026-01-04 17:49:08.048761"], ["updated_at", "2026-01-04 17:49:08.048761"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
UrlServiceTest: test_decode_extracts_short_code_from_full_URL
-------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_404_for_non-existent_short_code
------------------------------------------------------------------------------------
Started GET "/api/v1/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 418)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_invalid_URL
----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "2ZlcIU"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "2ZlcIU"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.3ms | ActiveRecord: 1.1ms | Allocations: 1230)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_empty_URL
--------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6tpb5p"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6tpb5p"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 1383)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_does_not_require_CSRF_token
------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Error occurred while parsing request parameters.
Contents:

url=https%3A%2F%2Fno-csrf.com
Processing by Api::V1::UrlsController#encode as HTML
Completed 500 Internal Server Error in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 120)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_original_URL_for_valid_short_code
--------------------------------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 347)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_creates_shortened_URL
------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-test.com/long/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-test.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "fmKx3X"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "fmKx3X"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-test.com/long/path"], ["short_code", "fmKx3X"], ["created_at", "2026-01-04 17:49:08.091196"], ["updated_at", "2026-01-04 17:49:08.091196"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 1167)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_returns_same_short_URL_for_duplicate_original_URL
----------------------------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7j7UNP"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7j7UNP"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-duplicate-test.com/path"], ["short_code", "7j7UNP"], ["created_at", "2026-01-04 17:49:08.099159"], ["updated_at", "2026-01-04 17:49:08.099159"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1116)
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 333)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encoded_URLs_can_be_decoded
-----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-roundtrip.com/test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-roundtrip.com/test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "0eQVFo"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "0eQVFo"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-roundtrip.com/test"], ["short_code", "0eQVFo"], ["created_at", "2026-01-04 17:49:08.109042"], ["updated_at", "2026-01-04 17:49:08.109042"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (Views: 0.2ms | ActiveRecord: 1.6ms | Allocations: 1116)
Started GET "/api/v1/decode?short_code" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>nil}
  [1m[36mUrl Load (1.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 404 Not Found in 2ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 260)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_accepts_full_short_URL
-------------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:49:08 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 354)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (622654802, 'https://www.google.com/search?q=ruby+on+rails', 'abc123', '2026-01-04 17:49:16.434187', '2026-01-04 17:49:16.434187'), (595373034, 'https://github.com/rails/rails', 'def456', '2026-01-04 17:49:16.434187', '2026-01-04 17:49:16.434187')[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_404_for_non-existent_short_code
------------------------------------------------------------------------------------
Started GET "/api/v1/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 6ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 2738)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_invalid_URL
----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XF2SUt"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XF2SUt"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 14ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 7857)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_creates_shortened_URL
------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-test.com/long/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-test.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cF7RWM"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cF7RWM"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-test.com/long/path"], ["short_code", "cF7RWM"], ["created_at", "2026-01-04 17:49:16.561526"], ["updated_at", "2026-01-04 17:49:16.561526"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1574)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_empty_URL
--------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "dBqO7E"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "dBqO7E"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 1440)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_does_not_require_CSRF_token
------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Error occurred while parsing request parameters.
Contents:

url=https%3A%2F%2Fno-csrf.com
Processing by Api::V1::UrlsController#encode as HTML
Completed 500 Internal Server Error in 0ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 99)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_original_URL_for_valid_short_code
--------------------------------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 338)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_accepts_full_short_URL
-------------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 354)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_returns_same_short_URL_for_duplicate_original_URL
----------------------------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XWhF7E"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XWhF7E"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-duplicate-test.com/path"], ["short_code", "XWhF7E"], ["created_at", "2026-01-04 17:49:16.592560"], ["updated_at", "2026-01-04 17:49:16.592560"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (Views: 0.2ms | ActiveRecord: 1.5ms | Allocations: 1116)
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 333)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encoded_URLs_can_be_decoded
-----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-roundtrip.com/test"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-roundtrip.com/test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "i0sMjV"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "i0sMjV"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-roundtrip.com/test"], ["short_code", "i0sMjV"], ["created_at", "2026-01-04 17:49:16.602599"], ["updated_at", "2026-01-04 17:49:16.602599"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1117)
Started GET "/api/v1/decode?short_code" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>nil}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 264)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
UrlServiceTest: test_decode_handles_empty_input
-----------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_empty_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "kdGKs9"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "kdGKs9"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
UrlServiceTest: test_decode_returns_failure_for_non-existent_code
-----------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
UrlServiceTest: test_encode_returns_existing_URL_for_duplicate
--------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlServiceTest: test_decode_returns_success_for_valid_short_code
----------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlServiceTest: test_decode_handles_nil_input
---------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
UrlServiceTest: test_decode_extracts_short_code_from_full_URL
-------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_invalid_URL
-----------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-valid"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "J6WKpg"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "J6WKpg"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_success_for_valid_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://service-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "fpSmt3"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "fpSmt3"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://service-test.com/path"], ["short_code", "fpSmt3"], ["created_at", "2026-01-04 17:49:16.638133"], ["updated_at", "2026-01-04 17:49:16.638133"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_encode_creates_shortened_URL
-----------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/long/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7YlU93"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7YlU93"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/long/path"], ["short_code", "7YlU93"], ["created_at", "2026-01-04 17:49:16.646438"], ["updated_at", "2026-01-04 17:49:16.646438"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1412)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_404_for_non-existent_short_code
-----------------------------------------------------------------------
Started GET "/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 217)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
UrlsControllerTest: test_encode_rejects_invalid_URL
---------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "TrTWMa"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "TrTWMa"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1130)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UrlsControllerTest: test_encode_rejects_empty_URL
-------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "R5KiTx"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "R5KiTx"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1385)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlsControllerTest: test_decode_accepts_full_short_URL
------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms | Allocations: 264)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
UrlsControllerTest: test_redirect_forwards_to_original_URL
----------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/abc123" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Redirected to https://www.google.com/search?q=ruby+on+rails
Completed 301 Moved Permanently in 1ms (ActiveRecord: 0.2ms | Allocations: 253)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlsControllerTest: test_encoded_URLs_persist_and_can_be_decoded
----------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://persistence-test.com/path"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://persistence-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "FH5iKc"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "FH5iKc"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://persistence-test.com/path"], ["short_code", "FH5iKc"], ["created_at", "2026-01-04 17:49:16.680657"], ["updated_at", "2026-01-04 17:49:16.680657"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1017)
Started GET "/decode?short_code=FH5iKc" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"FH5iKc"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "FH5iKc"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 241)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_original_URL_for_valid_short_code
-------------------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 241)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
UrlsControllerTest: test_encode_returns_same_short_URL_for_duplicate_original_URL
---------------------------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WE5IGd"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WE5IGd"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/duplicate-test"], ["short_code", "WE5IGd"], ["created_at", "2026-01-04 17:49:16.694612"], ["updated_at", "2026-01-04 17:49:16.694612"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 1018)
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 234)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_redirect_returns_404_for_non-existent_short_code
-------------------------------------------------------------------------
Started GET "/zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 4)
Completed 404 Not Found in 4ms (Views: 3.2ms | ActiveRecord: 0.2ms | Allocations: 1517)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_home_page_loads_successfully
-----------------------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-04 19:49:16 +0200
Processing by UrlsController#home as HTML
  Rendering layout layouts/application.html.erb
  Rendering urls/home.html.erb within layouts/application
  Rendered urls/home.html.erb within layouts/application (Duration: 0.7ms | Allocations: 516)
  Rendered layout layouts/application.html.erb (Duration: 61.7ms | Allocations: 29388)
Completed 200 OK in 65ms (Views: 62.5ms | ActiveRecord: 0.0ms | Allocations: 30928)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
UrlTest: test_accepts_valid_HTTP_URL
------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "CicbRW"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "CicbRW"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlTest: test_encode_creates_new_URL_for_new_original_url
---------------------------------------------------------
  [1m[36mUrl Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://newsite.com/unique-path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cewWMg"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cewWMg"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://newsite.com/unique-path"], ["short_code", "cewWMg"], ["created_at", "2026-01-04 17:49:16.780616"], ["updated_at", "2026-01-04 17:49:16.780616"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlTest: test_does_not_regenerate_short_code_on_update
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "V6JR4v"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "V6JR4v"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "V6JR4v"], ["created_at", "2026-01-04 17:49:16.785103"], ["updated_at", "2026-01-04 17:49:16.785103"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Update (0.3ms)[0m  [1m[33mUPDATE "urls" SET "original_url" = $1, "updated_at" = $2 WHERE "urls"."id" = $3[0m  [["original_url", "https://example.org"], ["updated_at", "2026-01-04 17:49:16.789274"], ["id", 622654811]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlTest: test_decode_returns_nil_for_non-existent_short_code
------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_generates_short_code_on_create
--------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "Nkd0eq"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "Nkd0eq"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/new-page"], ["short_code", "Nkd0eq"], ["created_at", "2026-01-04 17:49:16.794797"], ["updated_at", "2026-01-04 17:49:16.794797"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------
UrlTest: test_short_code_uniqueness
-----------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_accepts_valid_HTTPS_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "tKpHqZ"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "tKpHqZ"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------
UrlTest: test_validates_URL_format
----------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "bPK5zC"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "bPK5zC"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_decode_finds_URL_by_short_code
--------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UrlTest: test_encode_returns_existing_URL_for_same_original_url
---------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlTest: test_validates_presence_of_original_url
------------------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "FuGOTD"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "FuGOTD"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------
UrlTest: test_rejects_FTP_URL
-----------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "l1lXTC"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "l1lXTC"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (622654802, 'https://www.google.com/search?q=ruby+on+rails', 'abc123', '2026-01-04 17:49:58.514994', '2026-01-04 17:49:58.514994'), (595373034, 'https://github.com/rails/rails', 'def456', '2026-01-04 17:49:58.514994', '2026-01-04 17:49:58.514994')[0m
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_original_URL_for_valid_short_code
-------------------------------------------------------------------------
  [1m[36mUrl Load (0.4ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 1195)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
UrlsControllerTest: test_encode_returns_same_short_URL_for_duplicate_original_URL
---------------------------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "KICiPJ"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "KICiPJ"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/duplicate-test"], ["short_code", "KICiPJ"], ["created_at", "2026-01-04 17:49:58.634080"], ["updated_at", "2026-01-04 17:49:58.634080"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 2191)
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 236)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_redirect_returns_404_for_non-existent_short_code
-------------------------------------------------------------------------
Started GET "/zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 4)
Completed 404 Not Found in 4ms (Views: 3.2ms | ActiveRecord: 0.2ms | Allocations: 1521)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlsControllerTest: test_encoded_URLs_persist_and_can_be_decoded
----------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://persistence-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://persistence-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "52XEKt"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "52XEKt"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://persistence-test.com/path"], ["short_code", "52XEKt"], ["created_at", "2026-01-04 17:49:58.651470"], ["updated_at", "2026-01-04 17:49:58.651470"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1251)
Started GET "/decode?short_code=52XEKt" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"52XEKt"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "52XEKt"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 245)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlsControllerTest: test_decode_accepts_full_short_URL
------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 262)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_home_page_loads_successfully
-----------------------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#home as HTML
  Rendering layout layouts/application.html.erb
  Rendering urls/home.html.erb within layouts/application
  Rendered urls/home.html.erb within layouts/application (Duration: 0.9ms | Allocations: 517)
  Rendered layout layouts/application.html.erb (Duration: 43.4ms | Allocations: 29716)
Completed 200 OK in 48ms (Views: 44.1ms | ActiveRecord: 0.0ms | Allocations: 31875)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
UrlsControllerTest: test_encode_rejects_invalid_URL
---------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "AP7q6S"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "AP7q6S"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1548)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_encode_creates_shortened_URL
-----------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/long/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "9fWYkL"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "9fWYkL"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/long/path"], ["short_code", "9fWYkL"], ["created_at", "2026-01-04 17:49:58.724772"], ["updated_at", "2026-01-04 17:49:58.724772"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1075)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UrlsControllerTest: test_encode_rejects_empty_URL
-------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "gdQNN7"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "gdQNN7"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1444)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
UrlsControllerTest: test_redirect_forwards_to_original_URL
----------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/abc123" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.4ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Redirected to https://www.google.com/search?q=ruby+on+rails
Completed 301 Moved Permanently in 1ms (ActiveRecord: 0.3ms | Allocations: 252)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_404_for_non-existent_short_code
-----------------------------------------------------------------------
Started GET "/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 214)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_does_not_require_CSRF_token
------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Error occurred while parsing request parameters.
Contents:

url=https%3A%2F%2Fno-csrf.com
Processing by Api::V1::UrlsController#encode as HTML
Completed 500 Internal Server Error in 0ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 248)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_returns_same_short_URL_for_duplicate_original_URL
----------------------------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "yP3C2Y"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "yP3C2Y"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-duplicate-test.com/path"], ["short_code", "yP3C2Y"], ["created_at", "2026-01-04 17:49:58.777092"], ["updated_at", "2026-01-04 17:49:58.777092"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1334)
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 334)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_empty_URL
--------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "AUAiz0"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "AUAiz0"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 1445)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_accepts_full_short_URL
-------------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 358)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_original_URL_for_valid_short_code
--------------------------------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 334)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encoded_URLs_can_be_decoded
-----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-roundtrip.com/test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-roundtrip.com/test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cqHLdz"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cqHLdz"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-roundtrip.com/test"], ["short_code", "cqHLdz"], ["created_at", "2026-01-04 17:49:58.804489"], ["updated_at", "2026-01-04 17:49:58.804489"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (Views: 0.2ms | ActiveRecord: 1.7ms | Allocations: 1116)
Started GET "/api/v1/decode?short_code" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>nil}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 266)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_creates_shortened_URL
------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-test.com/long/path"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-test.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6ccqfo"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6ccqfo"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-test.com/long/path"], ["short_code", "6ccqfo"], ["created_at", "2026-01-04 17:49:58.820627"], ["updated_at", "2026-01-04 17:49:58.820627"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 1117)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_invalid_URL
----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "pkUoD3"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "pkUoD3"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1074)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_404_for_non-existent_short_code
------------------------------------------------------------------------------------
Started GET "/api/v1/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:49:58 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 202)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_decode_finds_URL_by_short_code
--------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UrlTest: test_encode_returns_existing_URL_for_same_original_url
---------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------
UrlTest: test_validates_URL_format
----------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "44D2qE"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "44D2qE"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_generates_short_code_on_create
--------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "oAScoQ"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "oAScoQ"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/new-page"], ["short_code", "oAScoQ"], ["created_at", "2026-01-04 17:49:58.844105"], ["updated_at", "2026-01-04 17:49:58.844105"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_accepts_valid_HTTPS_URL
-------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "sUbI5L"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "sUbI5L"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------
UrlTest: test_rejects_FTP_URL
-----------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "QHNFay"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "QHNFay"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlTest: test_encode_creates_new_URL_for_new_original_url
---------------------------------------------------------
  [1m[36mUrl Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://newsite.com/unique-path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XJ2G4u"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "XJ2G4u"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://newsite.com/unique-path"], ["short_code", "XJ2G4u"], ["created_at", "2026-01-04 17:49:58.853268"], ["updated_at", "2026-01-04 17:49:58.853268"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlTest: test_decode_returns_nil_for_non-existent_short_code
------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlTest: test_does_not_regenerate_short_code_on_update
------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "8BOb44"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "8BOb44"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "8BOb44"], ["created_at", "2026-01-04 17:49:58.860367"], ["updated_at", "2026-01-04 17:49:58.860367"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Update (0.3ms)[0m  [1m[33mUPDATE "urls" SET "original_url" = $1, "updated_at" = $2 WHERE "urls"."id" = $3[0m  [["original_url", "https://example.org"], ["updated_at", "2026-01-04 17:49:58.865669"], ["id", 622654811]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------
UrlTest: test_short_code_uniqueness
-----------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
UrlTest: test_accepts_valid_HTTP_URL
------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "IIiL3Z"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "IIiL3Z"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlTest: test_validates_presence_of_original_url
------------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "iE2SJp"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "iE2SJp"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlServiceTest: test_decode_returns_success_for_valid_short_code
----------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_invalid_URL
-----------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-valid"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "5PexI4"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "5PexI4"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
UrlServiceTest: test_encode_returns_existing_URL_for_duplicate
--------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
UrlServiceTest: test_decode_extracts_short_code_from_full_URL
-------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlServiceTest: test_decode_handles_nil_input
---------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_success_for_valid_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://service-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "PmyPKN"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "PmyPKN"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://service-test.com/path"], ["short_code", "PmyPKN"], ["created_at", "2026-01-04 17:49:58.891178"], ["updated_at", "2026-01-04 17:49:58.891178"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
UrlServiceTest: test_decode_returns_failure_for_non-existent_code
-----------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_empty_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "egIqUK"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "egIqUK"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
UrlServiceTest: test_decode_handles_empty_input
-----------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (622654802, 'https://www.google.com/search?q=ruby+on+rails', 'abc123', '2026-01-04 17:50:26.506401', '2026-01-04 17:50:26.506401'), (595373034, 'https://github.com/rails/rails', 'def456', '2026-01-04 17:50:26.506401', '2026-01-04 17:50:26.506401')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_creates_shortened_URL
------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:50:26 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-test.com/long/path"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-test.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "D1eJIz"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "D1eJIz"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-test.com/long/path"], ["short_code", "D1eJIz"], ["created_at", "2026-01-04 17:50:26.601058"], ["updated_at", "2026-01-04 17:50:26.601058"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 20ms (Views: 0.3ms | ActiveRecord: 1.7ms | Allocations: 9590)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (622654802, 'https://www.google.com/search?q=ruby+on+rails', 'abc123', '2026-01-04 17:52:26.959525', '2026-01-04 17:52:26.959525'), (595373034, 'https://github.com/rails/rails', 'def456', '2026-01-04 17:52:26.959525', '2026-01-04 17:52:26.959525')[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlTest: test_validates_presence_of_original_url
------------------------------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "MmS0Tg"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "MmS0Tg"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------
UrlTest: test_validates_URL_format
----------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "YRZo0O"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "YRZo0O"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------
UrlTest: test_accepts_valid_HTTP_URL
------------------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cZGPhF"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cZGPhF"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------
UrlTest: test_short_code_uniqueness
-----------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_generates_short_code_on_create
--------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WnDdW8"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WnDdW8"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/new-page"], ["short_code", "WnDdW8"], ["created_at", "2026-01-04 17:52:27.010094"], ["updated_at", "2026-01-04 17:52:27.010094"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_accepts_valid_HTTPS_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "BukLu7"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "BukLu7"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UrlTest: test_encode_returns_existing_URL_for_same_original_url
---------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlTest: test_decode_returns_nil_for_non-existent_short_code
------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlTest: test_does_not_regenerate_short_code_on_update
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "G4PyRf"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "G4PyRf"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "G4PyRf"], ["created_at", "2026-01-04 17:52:27.020074"], ["updated_at", "2026-01-04 17:52:27.020074"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Update (0.2ms)[0m  [1m[33mUPDATE "urls" SET "original_url" = $1, "updated_at" = $2 WHERE "urls"."id" = $3[0m  [["original_url", "https://example.org"], ["updated_at", "2026-01-04 17:52:27.024039"], ["id", 622654804]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_decode_finds_URL_by_short_code
--------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlTest: test_encode_creates_new_URL_for_new_original_url
---------------------------------------------------------
  [1m[36mUrl Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://newsite.com/unique-path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "eU6p7M"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "eU6p7M"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://newsite.com/unique-path"], ["short_code", "eU6p7M"], ["created_at", "2026-01-04 17:52:27.032058"], ["updated_at", "2026-01-04 17:52:27.032058"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------
UrlTest: test_rejects_FTP_URL
-----------------------------
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "dVMhqL"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "dVMhqL"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
UrlServiceTest: test_decode_handles_empty_input
-----------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
UrlServiceTest: test_decode_returns_failure_for_non-existent_code
-----------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_invalid_URL
-----------------------------------------------------------
  [1m[36mUrl Load (0.4ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-valid"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "VpgmqW"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "VpgmqW"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
UrlServiceTest: test_decode_extracts_short_code_from_full_URL
-------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlServiceTest: test_decode_handles_nil_input
---------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_failure_for_empty_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "68A9Lk"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "68A9Lk"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlServiceTest: test_decode_returns_success_for_valid_short_code
----------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
UrlServiceTest: test_encode_returns_existing_URL_for_duplicate
--------------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://www.google.com/search?q=ruby+on+rails"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlServiceTest: test_encode_returns_success_for_valid_URL
---------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://service-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "eriiyB"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "eriiyB"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://service-test.com/path"], ["short_code", "eriiyB"], ["created_at", "2026-01-04 17:52:27.062536"], ["updated_at", "2026-01-04 17:52:27.062536"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_404_for_non-existent_short_code
------------------------------------------------------------------------------------
Started GET "/api/v1/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.4ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 2ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 585)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_creates_shortened_URL
------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-test.com/long/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-test.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "UxnKKt"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "UxnKKt"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-test.com/long/path"], ["short_code", "UxnKKt"], ["created_at", "2026-01-04 17:52:27.164411"], ["updated_at", "2026-01-04 17:52:27.164411"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1325)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_returns_same_short_URL_for_duplicate_original_URL
----------------------------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "PCRbUn"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "PCRbUn"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-duplicate-test.com/path"], ["short_code", "PCRbUn"], ["created_at", "2026-01-04 17:52:27.171617"], ["updated_at", "2026-01-04 17:52:27.171617"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 1015)
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-duplicate-test.com/path"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-duplicate-test.com/path"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms | Allocations: 233)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_accepts_full_short_URL
-------------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 256)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_decode_returns_original_URL_for_valid_short_code
--------------------------------------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/api/v1/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 232)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_invalid_URL
----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WmfY2S"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "WmfY2S"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 1148)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_does_not_require_CSRF_token
------------------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://no-csrf.com"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://no-csrf.com"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "fOwv7m"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "fOwv7m"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://no-csrf.com"], ["short_code", "fOwv7m"], ["created_at", "2026-01-04 17:52:27.195191"], ["updated_at", "2026-01-04 17:52:27.195191"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1015)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encode_rejects_empty_URL
--------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RN0ovA"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RN0ovA"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 1383)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::UrlsControllerTest: test_api_encoded_URLs_can_be_decoded
-----------------------------------------------------------------
Started POST "/api/v1/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#encode as JSON
  Parameters: {"url"=>"https://api-roundtrip.com/test"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://api-roundtrip.com/test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RRuTyC"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RRuTyC"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://api-roundtrip.com/test"], ["short_code", "RRuTyC"], ["created_at", "2026-01-04 17:52:27.208849"], ["updated_at", "2026-01-04 17:52:27.208849"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.5ms | Allocations: 1015)
Started GET "/api/v1/decode?short_code=RRuTyC" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by Api::V1::UrlsController#decode as HTML
  Parameters: {"short_code"=>"RRuTyC"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "RRuTyC"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 232)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UrlsControllerTest: test_encoded_URLs_persist_and_can_be_decoded
----------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://persistence-test.com/path"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://persistence-test.com/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "HCwvwS"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "HCwvwS"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://persistence-test.com/path"], ["short_code", "HCwvwS"], ["created_at", "2026-01-04 17:52:27.220428"], ["updated_at", "2026-01-04 17:52:27.220428"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1412)
Started GET "/decode?short_code=HCwvwS" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"HCwvwS"}
  [1m[36mUrl Load (0.4ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "HCwvwS"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 248)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
UrlsControllerTest: test_redirect_forwards_to_original_URL
----------------------------------------------------------
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/abc123" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Redirected to https://www.google.com/search?q=ruby+on+rails
Completed 301 Moved Permanently in 1ms (ActiveRecord: 0.2ms | Allocations: 253)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_404_for_non-existent_short_code
-----------------------------------------------------------------------
Started GET "/decode?short_code=zzzzzz" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 213)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_redirect_returns_404_for_non-existent_short_code
-------------------------------------------------------------------------
Started GET "/zzzzzz" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"zzzzzz"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "zzzzzz"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 4)
Completed 404 Not Found in 4ms (Views: 3.6ms | ActiveRecord: 0.2ms | Allocations: 1517)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
UrlsControllerTest: test_encode_returns_same_short_URL_for_duplicate_original_URL
---------------------------------------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "QgRrdw"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "QgRrdw"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/duplicate-test"], ["short_code", "QgRrdw"], ["created_at", "2026-01-04 17:52:27.247220"], ["updated_at", "2026-01-04 17:52:27.247220"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 1251)
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/duplicate-test"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/duplicate-test"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 235)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UrlsControllerTest: test_decode_accepts_full_short_URL
------------------------------------------------------
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_url=http%3A%2F%2Fexample.com%2Fabc123" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_url"=>"http://example.com/abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms | Allocations: 265)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_encode_creates_shortened_URL
-----------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"https://example.com/long/path"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "https://example.com/long/path"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "DnEMeA"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "DnEMeA"], ["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com/long/path"], ["short_code", "DnEMeA"], ["created_at", "2026-01-04 17:52:27.261018"], ["updated_at", "2026-01-04 17:52:27.261018"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 1017)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UrlsControllerTest: test_encode_rejects_empty_URL
-------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>""}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", ""], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "3Mjz3p"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "3Mjz3p"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 4ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 1438)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UrlsControllerTest: test_decode_returns_original_URL_for_valid_short_code
-------------------------------------------------------------------------
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."id" = $1 LIMIT $2[0m  [["id", 622654802], ["LIMIT", 1]]
Started GET "/decode?short_code=abc123" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#decode as HTML
  Parameters: {"short_code"=>"abc123"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "abc123"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 242)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
UrlsControllerTest: test_encode_rejects_invalid_URL
---------------------------------------------------
Started POST "/encode" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#encode as JSON
  Parameters: {"url"=>"not-a-valid-url"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."original_url" = $1 LIMIT $2[0m  [["original_url", "not-a-valid-url"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "hKI3GC"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "hKI3GC"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 1080)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_home_page_loads_successfully
-----------------------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-04 19:52:27 +0200
Processing by UrlsController#home as HTML
  Rendering layout layouts/application.html.erb
  Rendering urls/home.html.erb within layouts/application
  Rendered urls/home.html.erb within layouts/application (Duration: 0.7ms | Allocations: 516)
  Rendered layout layouts/application.html.erb (Duration: 44.9ms | Allocations: 29706)
Completed 200 OK in 50ms (Views: 45.7ms | ActiveRecord: 0.0ms | Allocations: 31241)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
